@startuml Sharded File Server - Upload Sequence

actor Client
participant "Sharded File Server" as Server
database "Shard Storage" as Storage
database "Backup Storage" as Backup
database "Metadata Storage" as Meta

== Upload Request ==

Client -> Server: POST /file\n(file + password)

== Identifier & Key Derivation ==

Server -> Server: Generate uniqueId
Server -> Server: Derive encryption key\n(from password + uniqueId)
Server -> Server: Derive seed\n(from password + uniqueId)

== Encryption & Sharding ==

Server -> Server: Encrypt file\n(using derived key)
Server -> Server: Split encrypted file\ninto N sharded files (N = 16)

== Hashing & Integrity ==

Server -> Server: Generate Merkle Tree\n(from sharded file hashes)

== Sharded File Storage ==

loop for each sharded file (1..16)
  Server -> Server: Derive storage path\n(from seed + index)
  Server -> Storage: Store sharded file
  Server -> Backup: Store sharded file (backup)
end

== Metadata Storage ==

Server -> Meta: Store Merkle Tree metadata\n(uniqueId â†’ Merkle Tree)

Server -> Client: Return uniqueId

@enduml
